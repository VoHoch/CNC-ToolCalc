# Change Request: Phase 1 - Design System & Base Components

**CR-ID:** CR-2025-11-11-001
**Version:** v0.0.1-alpha â†’ v0.1.0-alpha
**Agent:** ui-specialist
**Status:** DRAFT
**Created:** 2025-11-11
**Updated:** 2025-11-11

---

## Summary

Implement the complete Design System foundation including design tokens, typography, and 7 base UI components (Slider, CompactSlider, Table, Button, Card, OperationMatrix, ProgressBar) with Dark Theme and 3 contrast modes.

---

## Type

- [x] Feature (new functionality)
- [ ] Enhancement
- [ ] Bug Fix
- [ ] Refactoring
- [ ] Documentation
- [ ] Test

---

## Motivation

Phase 1 requires a solid Design System foundation before any screen implementations. The UI components must be:
- Dark theme ONLY (no light mode)
- Accessible (WCAG 2.1 AA)
- Consistent (design tokens)
- Reusable (component library)
- Testable (Storybook)

This CR establishes the visual language and component library that Frontend/Workflow agent will use for screen implementations.

---

## Detailed Description

### Design System Setup
1. **Design Tokens** (`src/styles/design-tokens.css`)
   - Color palette (bg, text, accent)
   - Spacing scale (compact: 2px to 32px)
   - Typography (Inter, Work Sans, Fira Code)
   - Border radius, shadows
   - 3 Contrast modes (medium, balanced, high)

2. **Font Installation**
   - Inter (primary UI font)
   - Work Sans (headlines)
   - Fira Code (monospace/code)

### Component Library (7 Components)

**1. Slider Component** (CRITICAL)
- **NO visible thumb!** (Architecture requirement)
- Gradient background (Blue â†’ Green â†’ Red)
- Marker-based interaction
- 3 markers: Conservative, Optimal, Aggressive
- Value display above track
- Left/right labels

**2. CompactSlider Component**
- Bidirectional slider (-50 to +50)
- For Expert Mode global adjustments
- Smaller version of Slider
- No gradient (single color)

**3. Table Component**
- Dark theme with 3 contrast modes
- Sortable columns
- Selectable rows
- Hover states
- Compact spacing
- Fixed header (scroll body)

**4. Button Component**
- 4 Variants: primary, secondary, outline, ghost
- 3 Sizes: small, medium, large
- Loading state
- Disabled state
- Icon support

**5. Card Component**
- Dark background
- Border (contrast-aware)
- Padding variants
- Hover effects
- Optional header/footer

**6. OperationMatrix Component**
- Grid layout (4 groups Ã— 1-4 operations)
- Color-coded by category:
  - FACE: Orange (#fb923c)
  - SLOT: Blue (#3b82f6)
  - GEOMETRY: Cyan (#06b6d4)
  - SPECIAL: Purple (#a855f7)
- Single selection
- Hover/active states

**7. ProgressBar Component**
- 6-step progress indicator
- Current step highlighted
- Completed steps marked
- Future steps dimmed
- Labels below each step

### Storybook Setup
- Install Storybook 7+
- Configure for Vite + React
- Create stories for all 7 components
- Document props
- Add usage examples

---

## Implementation Details

### Files Created (NEW)

**Design System:**
```
frontend/src/styles/
â”œâ”€â”€ design-tokens.css           (200 lines)
â”œâ”€â”€ reset.css                   (50 lines)
â””â”€â”€ globals.css                 (100 lines)
```

**Components:**
```
frontend/src/components/common/
â”œâ”€â”€ Slider/
â”‚   â”œâ”€â”€ Slider.tsx              (150 lines)
â”‚   â”œâ”€â”€ Slider.css              (100 lines)
â”‚   â””â”€â”€ Slider.stories.tsx      (80 lines)
â”œâ”€â”€ CompactSlider/
â”‚   â”œâ”€â”€ CompactSlider.tsx       (120 lines)
â”‚   â”œâ”€â”€ CompactSlider.css       (80 lines)
â”‚   â””â”€â”€ CompactSlider.stories.tsx (60 lines)
â”œâ”€â”€ Table/
â”‚   â”œâ”€â”€ Table.tsx               (200 lines)
â”‚   â”œâ”€â”€ Table.css               (120 lines)
â”‚   â””â”€â”€ Table.stories.tsx       (100 lines)
â”œâ”€â”€ Button/
â”‚   â”œâ”€â”€ Button.tsx              (100 lines)
â”‚   â”œâ”€â”€ Button.css              (80 lines)
â”‚   â””â”€â”€ Button.stories.tsx      (60 lines)
â”œâ”€â”€ Card/
â”‚   â”œâ”€â”€ Card.tsx                (80 lines)
â”‚   â”œâ”€â”€ Card.css                (60 lines)
â”‚   â””â”€â”€ Card.stories.tsx        (50 lines)
â”œâ”€â”€ OperationMatrix/
â”‚   â”œâ”€â”€ OperationMatrix.tsx     (150 lines)
â”‚   â”œâ”€â”€ OperationMatrix.css     (100 lines)
â”‚   â””â”€â”€ OperationMatrix.stories.tsx (80 lines)
â””â”€â”€ ProgressBar/
    â”œâ”€â”€ ProgressBar.tsx         (100 lines)
    â”œâ”€â”€ ProgressBar.css         (60 lines)
    â””â”€â”€ ProgressBar.stories.tsx (50 lines)
```

**Storybook Config:**
```
frontend/.storybook/
â”œâ”€â”€ main.ts
â”œâ”€â”€ preview.ts
â””â”€â”€ manager.ts
```

**Total Estimated Lines:** ~2,100 lines

### Dependencies

**New packages (frontend/package.json):**
```json
{
  "dependencies": {
    "react": "^18.2.0",
    "react-dom": "^18.2.0"
  },
  "devDependencies": {
    "@storybook/react": "^7.6.0",
    "@storybook/addon-essentials": "^7.6.0",
    "@storybook/addon-a11y": "^7.6.0",
    "@storybook/vite": "^7.6.0"
  }
}
```

---

## Architecture Compliance

- [x] Follows Cleanroom principle (no V2.0 code)
- [x] Implements Component Interface specifications
  - Reference: `docs/contracts/COMPONENT_INTERFACE.md`
- [x] Dark Theme ONLY (no light mode)
- [x] 3 Contrast modes (medium, balanced, high)
- [x] Slider: NO visible thumb âœ“
- [x] Accessibility WCAG 2.1 AA
  - Keyboard navigation
  - ARIA labels
  - Focus indicators
  - Color contrast ratios

---

## Testing

### Unit Tests
- [ ] Slider: 15 tests (interactions, markers, value changes)
- [ ] CompactSlider: 10 tests (bidirectional, bounds)
- [ ] Table: 20 tests (sorting, selection, rendering)
- [ ] Button: 12 tests (variants, states, clicks)
- [ ] Card: 8 tests (rendering, hover)
- [ ] OperationMatrix: 15 tests (selection, categories)
- [ ] ProgressBar: 10 tests (steps, current, completed)
- [ ] **Total:** 90 tests
- [ ] **Coverage Target:** >90%

### Integration Tests
- [ ] All components render in Storybook
- [ ] Design tokens applied correctly
- [ ] Contrast mode switching works
- [ ] Keyboard navigation functional

### Smoke Test
- [ ] Run Storybook: `npm run storybook`
- [ ] Verify all 7 components visible
- [ ] Test Slider: NO thumb visible âœ“
- [ ] Test Table: dark theme applied âœ“
- [ ] Test OperationMatrix: 4 color groups âœ“
- [ ] Test contrast mode toggle

**Smoke Test Script:** `scripts/smoke-test-cr-001.sh`

```bash
#!/bin/bash
# Smoke Test: Design System & Components

echo "ðŸ§ª Starting Smoke Test: CR-2025-11-11-001"

# Check if Storybook builds
npm run storybook:build || exit 1

# Check component files exist
COMPONENTS=(Slider CompactSlider Table Button Card OperationMatrix ProgressBar)
for comp in "${COMPONENTS[@]}"; do
  [ -f "frontend/src/components/common/$comp/$comp.tsx" ] || exit 1
done

# Check design tokens exist
[ -f "frontend/src/styles/design-tokens.css" ] || exit 1

echo "âœ… Smoke Test PASSED"
```

---

## Quality Audit

### Code Quality
- [ ] TypeScript: 100% type coverage (no `any`)
- [ ] ESLint: 0 errors
- [ ] Prettier: Code formatted
- [ ] No code duplication >10 lines
- [ ] Component complexity <15

### Performance
- [ ] Component render time <16ms (60fps)
- [ ] Storybook build time <30s
- [ ] CSS bundle size <50KB

### Security
- [ ] No inline styles with user input
- [ ] No dangerouslySetInnerHTML
- [ ] Sanitized props

---

## User Acceptance Test (UAT)

**UAT Test Plan:**
1. Open Storybook (`npm run storybook`)
2. Verify Slider component:
   - No visible thumb âœ“
   - Gradient background visible âœ“
   - 3 markers (Conservative, Optimal, Aggressive) âœ“
   - Value changes on drag âœ“
3. Verify Table component:
   - Dark theme applied âœ“
   - Sortable columns work âœ“
   - Row selection works âœ“
4. Verify OperationMatrix:
   - 4 color-coded groups âœ“
   - Single selection works âœ“
5. Test contrast mode toggle:
   - Switch between medium/balanced/high âœ“
   - Borders change visibility âœ“
6. Keyboard navigation:
   - Tab through all interactive elements âœ“
   - Enter/Space trigger actions âœ“

**UAT Results:**
- [ ] UAT completed by: [User Name]
- [ ] UAT date: YYYY-MM-DD
- [ ] UAT status: [PASSED / FAILED]

---

## Rollback Plan

```bash
# Revert changes
git revert <commit-hash>

# OR restore from backup
git checkout v0.0.1-alpha -- frontend/src/
```

---

## Related Change Requests

- **Blocks:** CR-2025-11-11-002 (Frontend needs these components)
- **Related:** Architecture document section 4.1-4.3

---

## Approval

- [ ] Agent self-review completed
- [ ] Governance Agent review completed
- [ ] Smoke test passed
- [ ] UAT passed
- [ ] Ready for merge

**Approved by:** [Pending]
**Date:** [Pending]

---

## Post-Merge

- [ ] Merged to `agent/ui-specialist`
- [ ] Governance reviewed
- [ ] Quality Gate 1 passed
- [ ] Tagged: `v0.1.0-alpha` (after all Phase 1 CRs)
- [ ] Documentation updated

---

**Agent Notes:**

This CR is the foundation for all UI work. Critical requirements:
1. **Slider MUST NOT have visible thumb** - use markers only
2. **Dark theme ONLY** - no light mode implementation
3. **3 Contrast modes** - must be toggleable
4. **WCAG 2.1 AA** - keyboard navigation + screen readers

Refer to:
- `docs/contracts/COMPONENT_INTERFACE.md` (616 lines)
- `docs/architecture/CNC_CALCULATOR_V4_FINAL_ARCHITECTURE_CONSOLIDATED.md` (sections 4.1-4.3)

Estimated time: 16-20 hours
